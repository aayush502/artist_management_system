{% extends 'users/base.html' %}
{% block content %}
    <div class="container">
    <h1 class="page-header">Users</h1>     
    <a class="btn btn-primary" href="/register">Add User</a>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>SN</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Dob</th>
            <th>Gender</th>
            <th>Phone</th>
            <th>Address</th>
            <th>Role</th>
        </tr>
        </thead>
        <tbody>
            {% for user in page %}
            <tr>
                <td>{{forloop.counter}}</td>
                <td>{{user.first_name}}</td>
                <td>{{user.last_name}}</td>
                <td>{{user.email}}</td>
                <td>{{user.dob}}</td>
                <td>{{user.gender}}</td>
                <td>{{user.phone}}</td>
                <td>{{user.address}}</td>
                <td>{{user.role}}</td>
                <td><a href="{% url 'user-update' pk=user.id %}" class="btn btn-primary">Update</a></td>
                <td><button class="deleteButton" data-user-id = "{{user.id}}" >Delete</button></td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center bg-warning">No User</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

        <div class="pagination">
            <span class="step-links">
                {% if page.has_previous %}
                    <a href="?page=1">&laquo; first</a>
                    <a href="?page={{ page.previous_page_number }}">previous</a>
                {% endif %}

                <span class="current-page">{{ page.number }}</span>

                {% if page.has_next %}
                    <a href="?page={{ page.next_page_number }}">next</a>
                    <a href="?page={{ page.paginator.num_pages }}">last &raquo;</a>
                {% endif %}
            </span>
        </div>
    </div>
    <script src='https://code.jquery.com/jquery-3.2.1.min.js'></script>

    <script>
        $(document).ready(function() {
            $('.deleteButton').click(function() {
                var csrfToken = '{{ csrf_token }}';
                var userId = $(this).data('user-id');
                
                var confirmed = confirm("Are you sure you want to delete this user?")
                if (!confirmed){
                    return;
                }
                $.ajax({
                    url: '/api/user-delete/' + userId,
                    type: 'DELETE',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('X-CSRFToken', csrfToken);
                    },
                    success: function(response) {
                        console.log(response);
                        window.location.href = '/user-list/'; // Redirect to user list
                    },
                    error: function(response) {
                        alert('Error deleting user.');
                    }
                });
            });
        });
    </script>
{% endblock content %}